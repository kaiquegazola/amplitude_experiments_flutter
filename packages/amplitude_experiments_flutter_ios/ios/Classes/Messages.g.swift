// Autogenerated from Pigeon (v22.7.4), do not edit directly.
// See also: https://pub.dev/packages/pigeon

import Foundation

#if os(iOS)
    import Flutter
#elseif os(macOS)
    import FlutterMacOS
#else
    #error("Unsupported platform.")
#endif

/// Error class for passing custom error details to Dart side.
final class PigeonError: Error {
    let code: String
    let message: String?
    let details: Any?

    init(code: String, message: String?, details: Any?) {
        self.code = code
        self.message = message
        self.details = details
    }

    var localizedDescription: String {
        return
            "PigeonError(code: \(code), message: \(message ?? "<nil>"), details: \(details ?? "<nil>")"
    }
}

private func wrapResult(_ result: Any?) -> [Any?] {
    return [result]
}

private func wrapError(_ error: Any) -> [Any?] {
    if let pigeonError = error as? PigeonError {
        return [
            pigeonError.code,
            pigeonError.message,
            pigeonError.details,
        ]
    }
    if let flutterError = error as? FlutterError {
        return [
            flutterError.code,
            flutterError.message,
            flutterError.details,
        ]
    }
    return [
        "\(error)",
        "\(type(of: error))",
        "Stacktrace: \(Thread.callStackSymbols)",
    ]
}

private func isNullish(_ value: Any?) -> Bool {
    return value is NSNull || value == nil
}

private func nilOrValue<T>(_ value: Any?) -> T? {
    if value is NSNull { return nil }
    return value as! T?
}

/// Server zone for Amplitude data center region
enum ServerZoneMessage: Int {
    case us = 0
    case eu = 1
}

/// Configuration message for the Amplitude Experiments client
///
/// Generated class from Pigeon that represents data sent in messages.
struct ExperimentConfigMessage {
    var debug: Bool
    var instanceName: String? = nil
    var serverZone: ServerZoneMessage
    var fetchTimeoutMillis: Int64
    var retryFetchOnFailure: Int64
    var automaticExposureTracking: Bool
    var fetchOnStart: Bool
    var initialVariants: [String?: VariantMessage?]? = nil

    // swift-format-ignore: AlwaysUseLowerCamelCase
    static func fromList(_ pigeonVar_list: [Any?]) -> ExperimentConfigMessage? {
        let debug = pigeonVar_list[0] as! Bool
        let instanceName: String? = nilOrValue(pigeonVar_list[1])
        let serverZone = pigeonVar_list[2] as! ServerZoneMessage
        let fetchTimeoutMillis = pigeonVar_list[3] as! Int64
        let retryFetchOnFailure = pigeonVar_list[4] as! Int64
        let automaticExposureTracking = pigeonVar_list[5] as! Bool
        let fetchOnStart = pigeonVar_list[6] as! Bool
        let initialVariants: [String?: VariantMessage?]? = nilOrValue(pigeonVar_list[7])

        return ExperimentConfigMessage(
            debug: debug,
            instanceName: instanceName,
            serverZone: serverZone,
            fetchTimeoutMillis: fetchTimeoutMillis,
            retryFetchOnFailure: retryFetchOnFailure,
            automaticExposureTracking: automaticExposureTracking,
            fetchOnStart: fetchOnStart,
            initialVariants: initialVariants
        )
    }

    func toList() -> [Any?] {
        return [
            debug,
            instanceName,
            serverZone,
            fetchTimeoutMillis,
            retryFetchOnFailure,
            automaticExposureTracking,
            fetchOnStart,
            initialVariants,
        ]
    }
}

/// User context message for experiment targeting
///
/// Generated class from Pigeon that represents data sent in messages.
struct ExperimentUserMessage {
    var userId: String? = nil
    var deviceId: String? = nil
    var userProperties: [String?: Any?]? = nil
    var groups: [String?: Any?]? = nil
    var groupProperties: [String?: [String?: Any?]?]? = nil

    // swift-format-ignore: AlwaysUseLowerCamelCase
    static func fromList(_ pigeonVar_list: [Any?]) -> ExperimentUserMessage? {
        let userId: String? = nilOrValue(pigeonVar_list[0])
        let deviceId: String? = nilOrValue(pigeonVar_list[1])
        let userProperties: [String?: Any?]? = nilOrValue(pigeonVar_list[2])
        let groups: [String?: Any?]? = nilOrValue(pigeonVar_list[3])
        let groupProperties: [String?: [String?: Any?]?]? = nilOrValue(pigeonVar_list[4])

        return ExperimentUserMessage(
            userId: userId,
            deviceId: deviceId,
            userProperties: userProperties,
            groups: groups,
            groupProperties: groupProperties
        )
    }

    func toList() -> [Any?] {
        return [
            userId,
            deviceId,
            userProperties,
            groups,
            groupProperties,
        ]
    }
}

/// Variant message representing an experiment variant
///
/// Generated class from Pigeon that represents data sent in messages.
struct VariantMessage {
    var key: String
    var value: String? = nil
    var payload: Any? = nil
    var expKey: String? = nil

    // swift-format-ignore: AlwaysUseLowerCamelCase
    static func fromList(_ pigeonVar_list: [Any?]) -> VariantMessage? {
        let key = pigeonVar_list[0] as! String
        let value: String? = nilOrValue(pigeonVar_list[1])
        let payload: Any? = pigeonVar_list[2]
        let expKey: String? = nilOrValue(pigeonVar_list[3])

        return VariantMessage(
            key: key,
            value: value,
            payload: payload,
            expKey: expKey
        )
    }

    func toList() -> [Any?] {
        return [
            key,
            value,
            payload,
            expKey,
        ]
    }
}

private class MessagesPigeonCodecReader: FlutterStandardReader {
    override func readValue(ofType type: UInt8) -> Any? {
        switch type {
        case 129:
            let enumResultAsInt: Int? = nilOrValue(readValue() as! Int?)
            if let enumResultAsInt = enumResultAsInt {
                return ServerZoneMessage(rawValue: enumResultAsInt)
            }
            return nil
        case 130:
            return ExperimentConfigMessage.fromList(readValue() as! [Any?])
        case 131:
            return ExperimentUserMessage.fromList(readValue() as! [Any?])
        case 132:
            return VariantMessage.fromList(readValue() as! [Any?])
        default:
            return super.readValue(ofType: type)
        }
    }
}

private class MessagesPigeonCodecWriter: FlutterStandardWriter {
    override func writeValue(_ value: Any) {
        if let value = value as? ServerZoneMessage {
            super.writeByte(129)
            super.writeValue(value.rawValue)
        } else if let value = value as? ExperimentConfigMessage {
            super.writeByte(130)
            super.writeValue(value.toList())
        } else if let value = value as? ExperimentUserMessage {
            super.writeByte(131)
            super.writeValue(value.toList())
        } else if let value = value as? VariantMessage {
            super.writeByte(132)
            super.writeValue(value.toList())
        } else {
            super.writeValue(value)
        }
    }
}

private class MessagesPigeonCodecReaderWriter: FlutterStandardReaderWriter {
    override func reader(with data: Data) -> FlutterStandardReader {
        return MessagesPigeonCodecReader(data: data)
    }

    override func writer(with data: NSMutableData) -> FlutterStandardWriter {
        return MessagesPigeonCodecWriter(data: data)
    }
}

class MessagesPigeonCodec: FlutterStandardMessageCodec, @unchecked Sendable {
    static let shared = MessagesPigeonCodec(readerWriter: MessagesPigeonCodecReaderWriter())
}

/// Host API for Amplitude Experiments platform communication
///
/// Generated protocol from Pigeon that represents a handler of messages from Flutter.
protocol AmplitudeExperimentsApi {
    /// Initialize the Amplitude Experiments client
    func initialize(deploymentKey: String, config: ExperimentConfigMessage, completion: @escaping (Result<Void, Error>) -> Void)
    /// Initialize with Amplitude Analytics integration
    func initializeWithAmplitudeAnalytics(deploymentKey: String, config: ExperimentConfigMessage, completion: @escaping (Result<Void, Error>) -> Void)
    /// Fetch variants for a user
    func fetch(user: ExperimentUserMessage?, completion: @escaping (Result<Void, Error>) -> Void)
    /// Get a specific variant by key
    func variant(key: String, fallback: VariantMessage?) throws -> VariantMessage?
    /// Get all variants
    func all() throws -> [String?: VariantMessage?]
    /// Track exposure for a variant
    func exposure(key: String) throws
    /// Clear all variants
    func clear() throws
}

/// Generated setup class from Pigeon to handle messages through the `binaryMessenger`.
class AmplitudeExperimentsApiSetup {
    static var codec: FlutterStandardMessageCodec { MessagesPigeonCodec.shared }
    /// Sets up an instance of `AmplitudeExperimentsApi` to handle messages through the `binaryMessenger`.
    static func setUp(binaryMessenger: FlutterBinaryMessenger, api: AmplitudeExperimentsApi?, messageChannelSuffix: String = "") {
        let channelSuffix = messageChannelSuffix.count > 0 ? ".\(messageChannelSuffix)" : ""
        /// Initialize the Amplitude Experiments client
        let initializeChannel = FlutterBasicMessageChannel(name: "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.initialize\(channelSuffix)", binaryMessenger: binaryMessenger, codec: codec)
        if let api = api {
            initializeChannel.setMessageHandler { message, reply in
                let args = message as! [Any?]
                let deploymentKeyArg = args[0] as! String
                let configArg = args[1] as! ExperimentConfigMessage
                api.initialize(deploymentKey: deploymentKeyArg, config: configArg) { result in
                    switch result {
                    case .success:
                        reply(wrapResult(nil))
                    case let .failure(error):
                        reply(wrapError(error))
                    }
                }
            }
        } else {
            initializeChannel.setMessageHandler(nil)
        }
        /// Initialize with Amplitude Analytics integration
        let initializeWithAmplitudeAnalyticsChannel = FlutterBasicMessageChannel(name: "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.initializeWithAmplitudeAnalytics\(channelSuffix)", binaryMessenger: binaryMessenger, codec: codec)
        if let api = api {
            initializeWithAmplitudeAnalyticsChannel.setMessageHandler { message, reply in
                let args = message as! [Any?]
                let deploymentKeyArg = args[0] as! String
                let configArg = args[1] as! ExperimentConfigMessage
                api.initializeWithAmplitudeAnalytics(deploymentKey: deploymentKeyArg, config: configArg) { result in
                    switch result {
                    case .success:
                        reply(wrapResult(nil))
                    case let .failure(error):
                        reply(wrapError(error))
                    }
                }
            }
        } else {
            initializeWithAmplitudeAnalyticsChannel.setMessageHandler(nil)
        }
        /// Fetch variants for a user
        let fetchChannel = FlutterBasicMessageChannel(name: "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.fetch\(channelSuffix)", binaryMessenger: binaryMessenger, codec: codec)
        if let api = api {
            fetchChannel.setMessageHandler { message, reply in
                let args = message as! [Any?]
                let userArg: ExperimentUserMessage? = nilOrValue(args[0])
                api.fetch(user: userArg) { result in
                    switch result {
                    case .success:
                        reply(wrapResult(nil))
                    case let .failure(error):
                        reply(wrapError(error))
                    }
                }
            }
        } else {
            fetchChannel.setMessageHandler(nil)
        }
        /// Get a specific variant by key
        let variantChannel = FlutterBasicMessageChannel(name: "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.variant\(channelSuffix)", binaryMessenger: binaryMessenger, codec: codec)
        if let api = api {
            variantChannel.setMessageHandler { message, reply in
                let args = message as! [Any?]
                let keyArg = args[0] as! String
                let fallbackArg: VariantMessage? = nilOrValue(args[1])
                do {
                    let result = try api.variant(key: keyArg, fallback: fallbackArg)
                    reply(wrapResult(result))
                } catch {
                    reply(wrapError(error))
                }
            }
        } else {
            variantChannel.setMessageHandler(nil)
        }
        /// Get all variants
        let allChannel = FlutterBasicMessageChannel(name: "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.all\(channelSuffix)", binaryMessenger: binaryMessenger, codec: codec)
        if let api = api {
            allChannel.setMessageHandler { _, reply in
                do {
                    let result = try api.all()
                    reply(wrapResult(result))
                } catch {
                    reply(wrapError(error))
                }
            }
        } else {
            allChannel.setMessageHandler(nil)
        }
        /// Track exposure for a variant
        let exposureChannel = FlutterBasicMessageChannel(name: "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.exposure\(channelSuffix)", binaryMessenger: binaryMessenger, codec: codec)
        if let api = api {
            exposureChannel.setMessageHandler { message, reply in
                let args = message as! [Any?]
                let keyArg = args[0] as! String
                do {
                    try api.exposure(key: keyArg)
                    reply(wrapResult(nil))
                } catch {
                    reply(wrapError(error))
                }
            }
        } else {
            exposureChannel.setMessageHandler(nil)
        }
        /// Clear all variants
        let clearChannel = FlutterBasicMessageChannel(name: "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.clear\(channelSuffix)", binaryMessenger: binaryMessenger, codec: codec)
        if let api = api {
            clearChannel.setMessageHandler { _, reply in
                do {
                    try api.clear()
                    reply(wrapResult(nil))
                } catch {
                    reply(wrapError(error))
                }
            }
        } else {
            clearChannel.setMessageHandler(nil)
        }
    }
}
