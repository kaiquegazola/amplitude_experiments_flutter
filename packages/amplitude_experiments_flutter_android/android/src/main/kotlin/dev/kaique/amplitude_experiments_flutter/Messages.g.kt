// Autogenerated from Pigeon (v22.7.4), do not edit directly.
// See also: https://pub.dev/packages/pigeon
@file:Suppress("UNCHECKED_CAST", "ArrayInDataClass")

package dev.kaique.amplitude_experiments_flutter

import android.util.Log
import io.flutter.plugin.common.BasicMessageChannel
import io.flutter.plugin.common.BinaryMessenger
import io.flutter.plugin.common.MessageCodec
import io.flutter.plugin.common.StandardMessageCodec
import java.io.ByteArrayOutputStream
import java.nio.ByteBuffer

private fun wrapResult(result: Any?): List<Any?> = listOf(result)

private fun wrapError(exception: Throwable): List<Any?> =
    if (exception is FlutterError) {
        listOf(
            exception.code,
            exception.message,
            exception.details,
        )
    } else {
        listOf(
            exception.javaClass.simpleName,
            exception.toString(),
            "Cause: " + exception.cause + ", Stacktrace: " + Log.getStackTraceString(exception),
        )
    }

/**
 * Error class for passing custom error details to Flutter via a thrown PlatformException.
 * @property code The error code.
 * @property message The error message.
 * @property details The error details. Must be a datatype supported by the api codec.
 */
class FlutterError(
    val code: String,
    override val message: String? = null,
    val details: Any? = null,
) : Throwable()

/** Server zone for Amplitude data center region */
enum class ServerZoneMessage(
    val raw: Int,
) {
    US(0),
    EU(1),
    ;

    companion object {
        fun ofRaw(raw: Int): ServerZoneMessage? = values().firstOrNull { it.raw == raw }
    }
}

/**
 * Configuration message for the Amplitude Experiments client
 *
 * Generated class from Pigeon that represents data sent in messages.
 */
data class ExperimentConfigMessage(
    val debug: Boolean,
    val instanceName: String? = null,
    val serverZone: ServerZoneMessage,
    val fetchTimeoutMillis: Long,
    val retryFetchOnFailure: Long,
    val automaticExposureTracking: Boolean,
    val fetchOnStart: Boolean,
    val initialVariants: Map<String?, VariantMessage?>? = null,
) {
    companion object {
        fun fromList(pigeonVar_list: List<Any?>): ExperimentConfigMessage {
            val debug = pigeonVar_list[0] as Boolean
            val instanceName = pigeonVar_list[1] as String?
            val serverZone = pigeonVar_list[2] as ServerZoneMessage
            val fetchTimeoutMillis = pigeonVar_list[3] as Long
            val retryFetchOnFailure = pigeonVar_list[4] as Long
            val automaticExposureTracking = pigeonVar_list[5] as Boolean
            val fetchOnStart = pigeonVar_list[6] as Boolean
            val initialVariants = pigeonVar_list[7] as Map<String?, VariantMessage?>?
            return ExperimentConfigMessage(
                debug,
                instanceName,
                serverZone,
                fetchTimeoutMillis,
                retryFetchOnFailure,
                automaticExposureTracking,
                fetchOnStart,
                initialVariants,
            )
        }
    }

    fun toList(): List<Any?> =
        listOf(
            debug,
            instanceName,
            serverZone,
            fetchTimeoutMillis,
            retryFetchOnFailure,
            automaticExposureTracking,
            fetchOnStart,
            initialVariants,
        )
}

/**
 * User context message for experiment targeting
 *
 * Generated class from Pigeon that represents data sent in messages.
 */
data class ExperimentUserMessage(
    val userId: String? = null,
    val deviceId: String? = null,
    val userProperties: Map<String?, Any?>? = null,
    val groups: Map<String?, Any?>? = null,
    val groupProperties: Map<String?, Map<String?, Any?>?>? = null,
) {
    companion object {
        fun fromList(pigeonVar_list: List<Any?>): ExperimentUserMessage {
            val userId = pigeonVar_list[0] as String?
            val deviceId = pigeonVar_list[1] as String?
            val userProperties = pigeonVar_list[2] as Map<String?, Any?>?
            val groups = pigeonVar_list[3] as Map<String?, Any?>?
            val groupProperties = pigeonVar_list[4] as Map<String?, Map<String?, Any?>?>?
            return ExperimentUserMessage(userId, deviceId, userProperties, groups, groupProperties)
        }
    }

    fun toList(): List<Any?> =
        listOf(
            userId,
            deviceId,
            userProperties,
            groups,
            groupProperties,
        )
}

/**
 * Variant message representing an experiment variant
 *
 * Generated class from Pigeon that represents data sent in messages.
 */
data class VariantMessage(
    val key: String,
    val value: String? = null,
    val payload: Any? = null,
    val expKey: String? = null,
) {
    companion object {
        fun fromList(pigeonVar_list: List<Any?>): VariantMessage {
            val key = pigeonVar_list[0] as String
            val value = pigeonVar_list[1] as String?
            val payload = pigeonVar_list[2]
            val expKey = pigeonVar_list[3] as String?
            return VariantMessage(key, value, payload, expKey)
        }
    }

    fun toList(): List<Any?> =
        listOf(
            key,
            value,
            payload,
            expKey,
        )
}

private open class MessagesPigeonCodec : StandardMessageCodec() {
    override fun readValueOfType(
        type: Byte,
        buffer: ByteBuffer,
    ): Any? {
        return when (type) {
            129.toByte() -> {
                return (readValue(buffer) as Long?)?.let {
                    ServerZoneMessage.ofRaw(it.toInt())
                }
            }
            130.toByte() -> {
                return (readValue(buffer) as? List<Any?>)?.let {
                    ExperimentConfigMessage.fromList(it)
                }
            }
            131.toByte() -> {
                return (readValue(buffer) as? List<Any?>)?.let {
                    ExperimentUserMessage.fromList(it)
                }
            }
            132.toByte() -> {
                return (readValue(buffer) as? List<Any?>)?.let {
                    VariantMessage.fromList(it)
                }
            }
            else -> super.readValueOfType(type, buffer)
        }
    }

    override fun writeValue(
        stream: ByteArrayOutputStream,
        value: Any?,
    ) {
        when (value) {
            is ServerZoneMessage -> {
                stream.write(129)
                writeValue(stream, value.raw)
            }
            is ExperimentConfigMessage -> {
                stream.write(130)
                writeValue(stream, value.toList())
            }
            is ExperimentUserMessage -> {
                stream.write(131)
                writeValue(stream, value.toList())
            }
            is VariantMessage -> {
                stream.write(132)
                writeValue(stream, value.toList())
            }
            else -> super.writeValue(stream, value)
        }
    }
}

/**
 * Host API for Amplitude Experiments platform communication
 *
 * Generated interface from Pigeon that represents a handler of messages from Flutter.
 */
interface AmplitudeExperimentsApi {
    /** Initialize the Amplitude Experiments client */
    fun initialize(
        deploymentKey: String,
        config: ExperimentConfigMessage,
        callback: (Result<Unit>) -> Unit,
    )

    /** Initialize with Amplitude Analytics integration */
    fun initializeWithAmplitudeAnalytics(
        deploymentKey: String,
        config: ExperimentConfigMessage,
        callback: (Result<Unit>) -> Unit,
    )

    /** Fetch variants for a user */
    fun fetch(
        user: ExperimentUserMessage?,
        callback: (Result<Unit>) -> Unit,
    )

    /** Get a specific variant by key */
    fun variant(
        key: String,
        fallback: VariantMessage?,
    ): VariantMessage?

    /** Get all variants */
    fun all(): Map<String?, VariantMessage?>

    /** Track exposure for a variant */
    fun exposure(key: String)

    /** Clear all variants */
    fun clear()

    companion object {
        /** The codec used by AmplitudeExperimentsApi. */
        val codec: MessageCodec<Any?> by lazy {
            MessagesPigeonCodec()
        }

        /** Sets up an instance of `AmplitudeExperimentsApi` to handle messages through the `binaryMessenger`. */
        @JvmOverloads
        fun setUp(
            binaryMessenger: BinaryMessenger,
            api: AmplitudeExperimentsApi?,
            messageChannelSuffix: String = "",
        ) {
            val separatedMessageChannelSuffix = if (messageChannelSuffix.isNotEmpty()) ".$messageChannelSuffix" else ""
            run {
                val channel =
                    BasicMessageChannel<Any?>(
                        binaryMessenger,
                        "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.initialize$separatedMessageChannelSuffix",
                        codec,
                    )
                if (api != null) {
                    channel.setMessageHandler { message, reply ->
                        val args = message as List<Any?>
                        val deploymentKeyArg = args[0] as String
                        val configArg = args[1] as ExperimentConfigMessage
                        api.initialize(deploymentKeyArg, configArg) { result: Result<Unit> ->
                            val error = result.exceptionOrNull()
                            if (error != null) {
                                reply.reply(wrapError(error))
                            } else {
                                reply.reply(wrapResult(null))
                            }
                        }
                    }
                } else {
                    channel.setMessageHandler(null)
                }
            }
            run {
                val channel =
                    BasicMessageChannel<Any?>(
                        binaryMessenger,
                        "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.initializeWithAmplitudeAnalytics$separatedMessageChannelSuffix",
                        codec,
                    )
                if (api != null) {
                    channel.setMessageHandler { message, reply ->
                        val args = message as List<Any?>
                        val deploymentKeyArg = args[0] as String
                        val configArg = args[1] as ExperimentConfigMessage
                        api.initializeWithAmplitudeAnalytics(deploymentKeyArg, configArg) { result: Result<Unit> ->
                            val error = result.exceptionOrNull()
                            if (error != null) {
                                reply.reply(wrapError(error))
                            } else {
                                reply.reply(wrapResult(null))
                            }
                        }
                    }
                } else {
                    channel.setMessageHandler(null)
                }
            }
            run {
                val channel =
                    BasicMessageChannel<Any?>(
                        binaryMessenger,
                        "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.fetch$separatedMessageChannelSuffix",
                        codec,
                    )
                if (api != null) {
                    channel.setMessageHandler { message, reply ->
                        val args = message as List<Any?>
                        val userArg = args[0] as ExperimentUserMessage?
                        api.fetch(userArg) { result: Result<Unit> ->
                            val error = result.exceptionOrNull()
                            if (error != null) {
                                reply.reply(wrapError(error))
                            } else {
                                reply.reply(wrapResult(null))
                            }
                        }
                    }
                } else {
                    channel.setMessageHandler(null)
                }
            }
            run {
                val channel =
                    BasicMessageChannel<Any?>(
                        binaryMessenger,
                        "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.variant$separatedMessageChannelSuffix",
                        codec,
                    )
                if (api != null) {
                    channel.setMessageHandler { message, reply ->
                        val args = message as List<Any?>
                        val keyArg = args[0] as String
                        val fallbackArg = args[1] as VariantMessage?
                        val wrapped: List<Any?> =
                            try {
                                listOf(api.variant(keyArg, fallbackArg))
                            } catch (exception: Throwable) {
                                wrapError(exception)
                            }
                        reply.reply(wrapped)
                    }
                } else {
                    channel.setMessageHandler(null)
                }
            }
            run {
                val channel =
                    BasicMessageChannel<Any?>(
                        binaryMessenger,
                        "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.all$separatedMessageChannelSuffix",
                        codec,
                    )
                if (api != null) {
                    channel.setMessageHandler { _, reply ->
                        val wrapped: List<Any?> =
                            try {
                                listOf(api.all())
                            } catch (exception: Throwable) {
                                wrapError(exception)
                            }
                        reply.reply(wrapped)
                    }
                } else {
                    channel.setMessageHandler(null)
                }
            }
            run {
                val channel =
                    BasicMessageChannel<Any?>(
                        binaryMessenger,
                        "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.exposure$separatedMessageChannelSuffix",
                        codec,
                    )
                if (api != null) {
                    channel.setMessageHandler { message, reply ->
                        val args = message as List<Any?>
                        val keyArg = args[0] as String
                        val wrapped: List<Any?> =
                            try {
                                api.exposure(keyArg)
                                listOf(null)
                            } catch (exception: Throwable) {
                                wrapError(exception)
                            }
                        reply.reply(wrapped)
                    }
                } else {
                    channel.setMessageHandler(null)
                }
            }
            run {
                val channel =
                    BasicMessageChannel<Any?>(
                        binaryMessenger,
                        "dev.flutter.pigeon.amplitude_experiments_flutter_platform_interface.AmplitudeExperimentsApi.clear$separatedMessageChannelSuffix",
                        codec,
                    )
                if (api != null) {
                    channel.setMessageHandler { _, reply ->
                        val wrapped: List<Any?> =
                            try {
                                api.clear()
                                listOf(null)
                            } catch (exception: Throwable) {
                                wrapError(exception)
                            }
                        reply.reply(wrapped)
                    }
                } else {
                    channel.setMessageHandler(null)
                }
            }
        }
    }
}
